# 项目06: 电机驱动和调速

## 1.实验简介：
驱动电机的方法有很多，我们这个小车用到的是最常用的DRV8833电机驱动芯片，该芯片为玩具、打印机及其它电机一体化应用提供了一款双通道桥式电动驱动器解决方案。
在本实验中，我们使用扩展板上的DRV8833电机驱动芯片驱动小车的两个直流电机，通过编写代码实现小车分别向前，向后，向左，向右行走的效果。

## 2.元件知识：
**DRV8833电机驱动芯片：** 具有电流控制功能的双H桥电机驱动器，可以驱动两个直流电机、一个双极步进电机、电磁阀或其他电感负载。每个H桥的输出驱动器块由N沟道功率MOSFET组成，配置为H桥以驱动电机绕组。每个H桥包括调节或限制绕组电流的电路。
带有故障输出引脚的内部停机功能是用于过大电流保护、短路保护、欠压锁定和超温。还提供了低功耗睡眠模式。我们来看一下DRV8833电机驱动芯片驱动两个直流电机的电路图和示意图：
![Img](../../media/项目06-1img-20230330104317.png)
![Img](../../media/项目06-2img-20230330104518.png)
如果想更深了解DRV8833电机驱动芯片，可以查看我们提供的芯片规格书，在资料的“附件”文件夹里。
![Img](../../media/项目06-3img-20230531143430.png)

## 3.规格参数：
- 逻辑部分输入电压：DC 5V
- 驱动部分输入电压：DC 5V
- 逻辑部分工作电流：<30mA
- 驱动部分工作电流：<2A
- 最大耗散功率：10W（T=80℃）
- 电机转速：5V  200 rpm / min
- 电机驱动形式：DRV8833双路H桥驱动
- 控制信号输入电平：高电平2.3V<Vin<5V  ，低电平-0.3V<Vin<1.5V
- 工作温度：-25~130℃

## 4.驱动小车运行原理：
根据上面电机驱动板的电路图和示意图，我们知道左电机的方向引脚在GPIO15，调速引脚在GPIO17；右电机的方向引脚在GPIO14，调速引脚在GPIO16，按照以下表格的运动逻辑，就可以知道如何通过控制数字口，PWM口控制2个电机转动，从而实现智能小车的行走。其中PWM值范围为0-255，设置数字越大，电机转动越快。

|功能|GPIO15|GPIO17（PWM）|左电机|GPIO14|GPIO16（PWM）|右电机|
| :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|前进|0|50000|正转|0|50000|正转|
|后退|1|10000|反转|1|10000|反转|
|左转|1|50000|反转|0|32768|正转|
|右转|0|32768|正转|1|50000|反转|
|停止|0|0|停止|0|0|停止|

## 5.实验代码：

本教程中使用的代码保存在：“**..\Keyes Beetlebot Pico 3合1 智能小车\4. Python 教程\3. 项目教程**” 的路径中。你可以把代码移到任何地方。例如，我们将代码保存在**D盘**中，<span style="color: rgb(0, 209, 0);">路径为D:\3. 项目教程</span>。
![Img](../../media/电脑D盘路径img-20230601164744.png)

打开“**Thonny**”软件，点击“**此电脑**”→“**D:**”→“**3. 项目教程**”→“**项目06 电机驱动和调速**”，然后鼠标左键双击“**Project_06_Motor_Drive_And_Speed_Regulation.py**”。
![Img](../../media/项目06-4img-20230602094355.png)

```
from machine import Pin,PWM
import time

# 右轮
pin1=Pin(14,Pin.OUT)
pin2=PWM(Pin(16))
pin2.freq(50)
# 左轮
pin3=Pin(15,Pin.OUT)
pin4=PWM(Pin(17))
pin4.freq(50)

# 作为小车前进的函数
def car_forward(): 
  pin1.value(0)
  pin2.duty_u16(50000) 
  pin3.value(0)
  pin4.duty_u16(50000)

# 作为小车后退的函数
def car_back(): 
  pin1.value(1)
  pin2.duty_u16(10000)  
  pin3.value(1)
  pin4.duty_u16(10000)

# 作为小车向左的函数
def car_left(): 
  pin1.value(0)
  pin2.duty_u16(50000)  
  pin3.value(1)
  pin4.duty_u16(32768)

# 作为小车向右的函数
def car_right(): 
  pin1.value(1)
  pin2.duty_u16(32768)  
  pin3.value(0)
  pin4.duty_u16(50000)

# 作为小车停止的函数
def car_stop(): 
  pin1.value(0)
  pin2.duty_u16(0)  
  pin3.value(0)
  pin4.duty_u16(0)    
try:
    while True:
        car_forward() #小车前进
        time.sleep(2) # 延时2s
        car_back() # 小车后退
        time.sleep(2)    
        car_left() # 小车向左
        time.sleep(2)    
        car_right() # 小车向右
        time.sleep(2)    
        car_stop() # 小车停止
        time.sleep(2)     
except:
    pass 
    
```
## 6.实验现象：
确保Raspberry Pi Pico主板已经连接到电脑上，单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”。
![Img](../../media/项目06-5img-20230602094749.png)

安上电池，将小车底板上的电源拨码开关拨到ON一端，开启电源。单击“![Img](../../media/运行img-20230511100130.png)”，代码开始执行，你会看到的现象是：小车前进2秒，后退2秒，左转2秒，右转2秒，停止2秒，循环。按“Ctrl+C”或单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”退出程序。
![Img](../../media/项目06-6img-20230602094711.png)

