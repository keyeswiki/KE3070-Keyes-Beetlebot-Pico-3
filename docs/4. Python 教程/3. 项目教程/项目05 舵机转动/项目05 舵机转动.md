# 项目05: 舵机转动

## 1.实验简介：
小车上有两个舵机，这里以接在引脚GPIO9的舵机为例，舵机是一种可以非常精确地旋转的电机。目前已广泛应用于玩具车、遥控直升机、飞机、机器人等领域。在这个项目中，我们将使用Raspberry Pi Pico主板控制舵机转动。

## 2.元件知识：
![Img](../../media/项目05-1img-20230330095339.png)
**舵机：** 舵机是一种位置伺服的驱动器，主要是由外壳、电路板、无核心马达、齿轮与位置检测器所构成。其工作原理是由接收机或者单片机发出信号给舵机，其内部有一个基准电路，产生周期为20ms，宽度为1.5ms 的基准信号，将获得的直流偏置电压与电位器的电压比较，获得电压差输出。经由电路板上的IC 判断转动方向，再驱动无核心马达开始转动，透过减速齿轮将动力传至摆臂，同时由位置检测器送回信号，判断是否已经到达定位。适用于那些需要角度不断变化并可以保持的控制系统。当电机转速一定时，通过级联减速齿轮带动电位器旋转，使得电压差为0，电机停止转动。
舵机有多种规格，但它们都有三根连接线，分别是棕色、红色、橙色(不同品牌可能有不同的颜色)。棕色为GND，红色为电源正极，橙色为信号线
![Img](../../media/项目05-2img-20230324190535.png)
舵机的伺服系统由可变宽度的脉冲来进行控制，橙色的控制线是用来传送脉冲的。一般而言，PWM控制舵机的基准信号周期为20ms（50Hz），理论上脉宽应在1ms到2ms之间，对应控制舵机角度是0°～180°。但是，实际上更多控制舵机的脉宽范围是0.5ms 到2.5ms，具体需要自己实际调试下。
![Img](../../media/项目05-3img-20230324190601.png)
经过实测，舵机的脉冲范围为0.65ms~2.5ms。180度舵机，对应的控制关系是这样的：
|高电平时间|舵机角度|基准信号周期时间（20ms）|
| :--: | :--: | :--: |
|0.65ms|0度|0.65ms高电平+19.35ms低电平|
|1.5ms|90度|1.5ms高电平+18.5ms低电平|
|2.5ms|180度|2.5ms高电平+17.5ms低电平|

舵机的规格参数：
|工作电压：|DC 4.8V〜6V|
| :--: | :--: |
|可操作角度范围：|可操作角度范围：|
|脉波宽度范围：|500→2500 μsec|
|外观尺寸：|22.9*12.2*30mm|
|空载转速：|0.12±0.01 sec/60度（DC 4.8V）  0.1±0.01 sec/60度（DC 6V）|
|空载电流：|200±20mA（DC 4.8V）  220±20mA（DC 6V）|
|停止扭力：|1.3±0.01kg·cm（DC 4.8V）  1.5±0.1kg·cm（DC 6V）|
|停止电流：|≦850mA（DC 4.8V）  ≦1000mA（DC 6V）|
|待机电流：|3±1mA（DC 4.8V）  4±1mA（DC 6V）|
|重量:|9±1g (不带舵机轴)|
|使用温度：|-30℃~60℃|

## 3.实验接线：
| 舵机 | 小车PCB板 |
| :--: | :--: |
| 棕线 | G |
| 红线 | 5V |
| 橙黄线 | S1（G9） |
![Img](../../media/项目05-实验接线img-20230508091835.png)

## 4.实验代码1：
控制超声波传感器转动的舵机是由Raspberry Pi Pico主板的GPIO9控制。

本教程中使用的代码保存在：“**..\Keyes Beetlebot Pico 3合1 智能小车\4. Python 教程\3. 项目教程**” 的路径中。你可以把代码移到任何地方。例如，我们将代码保存在**D盘**中，<span style="color: rgb(0, 209, 0);">路径为D:\3. 项目教程</span>。
![Img](../../media/电脑D盘路径img-20230601164744.png)

打开“**Thonny**”软件，点击“**此电脑**”→“**D:**”→“**3. 项目教程**”→“**项目05 舵机转动**”，并鼠标左键双击“**Project_05.1_Servo_Rotate.py**”。
![Img](../../media/项目05-4img-20230602092838.png)

```
from machine import Pin, PWM
import time

#定义GPIO9的输出频率为50Hz，并将其分配给PWM。
pwm = PWM(Pin(9))
pwm.freq(50)

'''
#占空比与舵机角度相对应
0°----2.5%----1638
45°----5%----3276
90°----7.5%----4915
135°----10%----6553
180°----12.5%----8192
'''
#舵机角度与其占空比相适应。 
angle_0 = 1638
angle_45 = 3276
angle_90 = 4915
angle_135 = 6553
angle_180 = 8192

while True:
    pwm.duty_u16(angle_0)
    time.sleep(1)
    pwm.duty_u16(angle_45)
    time.sleep(1)
    pwm.duty_u16(angle_90)
    time.sleep(1)
    pwm.duty_u16(angle_135)
    time.sleep(1)
    pwm.duty_u16(angle_180)
    time.sleep(1)

```
## 5.实验现象1：
确保Raspberry Pi Pico主板已经连接到电脑上，单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”。
![Img](../../media/项目05-5img-20230602092941.png)

安上电池，将小车底板上的电源拨码开关拨到ON一端，开启电源。单击“![Img](../../media/运行img-20230511100130.png)”，代码开始执行，你会看到的现象是：舵机将转动。按“Ctrl+C”或单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”退出程序。
![Img](../../media/项目05-6img-20230602093123.png)

## 6.实验代码2：
控制超声波传感器转动的舵机是由Raspberry Pi Pico主板的GPIO9控制。

本教程中使用的代码保存在：“**..\Keyes Beetlebot Pico 3合1 智能小车\4. Python 教程\3. 项目教程**” 的路径中。你可以把代码移到任何地方。例如，我们将代码保存在**D盘**中，<span style="color: rgb(0, 209, 0);">路径为D:\3. 项目教程</span>。
![Img](../../media/电脑D盘路径img-20230601164744.png)

打开“**Thonny**”软件，点击“**此电脑**”→“**D:**”→“**3. 项目教程**”→“**项目05 舵机转动**”，选择“myservo\.py”，右击鼠标选择“上传到/”，等待“myservo\.py”被上传到Raspberry Pi Pico主板，然后鼠标左键双击“**Project_05.2_Servo_Sweep.py**”。
![Img](../../media/项目05-7img-20230602093450.png)
![Img](../../media/项目05-8img-20230602093516.png)

```
from myservo import Servo
import time

servo=Servo(9)
servo.ServoAngle(0)
time.sleep_ms(1000)

try:
    while True:       
        for i in range(0, 180, 1):
            servo.ServoAngle(i)
            time.sleep_ms(15)
        for i in range(180, 0, -1):
            servo.ServoAngle(i)
            time.sleep_ms(15)        
except:
    servo.deinit()

```
## 7.实验现象2：
确保Raspberry Pi Pico主板已经连接到电脑上，单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”。
![Img](../../media/项目05-9img-20230602093606.png)

安上电池，将小车底板上的电源拨码开关拨到ON一端，开启电源。单击“![Img](../../media/运行img-20230511100130.png)”，代码开始执行，你会看到的现象是：舵机将从0°旋转到180°，然后反向方向，使其从180°旋转到0°，循环往复地重复这些动作，像扫地一样。按“Ctrl+C”或单击“![Img](../../media/停止或重启后端进程img-20230511100302.png)”退出程序。
![Img](../../media/项目05-10img-20230602093647.png)


